import utils
import pygame


class Country(pygame.sprite.Sprite):
    def __init__(self, name: str, people, sicked, koef_e, polygon):
        super().__init__()
        self.name = name
        self.people = people
        self.sicked = sicked
        self.koef_e = koef_e
        self.polygon = polygon

    def update(self):
        def point_in_polygon(point: list[int, int] | tuple[int, int], polygon: list[list[int, int]]) -> bool:
            x, y = point
            n = len(polygon)
            inside = False
            p1x, p1y = polygon[0]
            xinters = 0.0
            for i in range(n + 1):
                p2x, p2y = polygon[i % n]
                if y > min(p1y, p2y):
                    if y <= max(p1y, p2y):
                        if x <= max(p1x, p2x):
                            if p1y != p2y:
                                xinters = (y - p1y) * (p2x - p1x) / (p2y - p1y) + p1x
                            if p1x == p2x or x <= xinters:
                                inside = not inside
                p1x, p1y = p2x, p2y
            return inside

    def draw(self, screen: pygame.Surface):

        percent_sicked = int((1/10) * 255)

        utils.draw_polygon_alpha(
            screen,
            pygame.Color(255, 0, 0, percent_sicked),
            self.polygon
        )


class Kazakhstan(Country):
    def __init__(self):
        super().__init__("Казахстан", 19000000, 0, 0.6, [
            [533, 212], [541, 195], [535, 194], [526, 183], [520, 186], [513, 180], [497, 186], [497, 194], [484, 192],
            [477, 190], [471, 196], [475, 203], [484, 215], [489, 207], [502, 210], [508, 216], [513, 217], [517, 213]
        ])


class Mongolia(Country):
    def __init__(self):
        super().__init__("Монголия", 3400948, 0, 0.45, [
            [552, 207], [561, 208], [562, 213], [573, 213], [586, 213], [606, 203], [599, 197], [594, 196], [585, 196],
            [579, 194], [568, 191], [563, 196], [558, 196], [548,197]
        ])


class Scandinavia(Country):
    def __init__(self):
        super().__init__("Скандинавия", 22000000, 0, 0.7, [
            [428, 133], [458, 145], [448, 150], [452, 155], [442, 158], [442, 165], [444, 169], [437, 170], [432, 167],
            [428, 173], [425, 168], [418, 171], [416, 177], [408, 182], [398, 179], [404, 176], [405, 171], [398, 179],
            [393, 173], [393, 162], [408, 149], [408, 143]
        ])


class Africa(Country):
    def __init__(self):
        super().__init__("Африка", 1429000000, 0, 0.4, [
            [479, 276], [464, 278], [442, 238], [423, 234], [417, 238], [405, 235], [405, 225], [379, 229], [360, 243],
            [351, 258], [352, 272], [368, 290], [390, 287], [403, 295], [401, 305], [408, 312], [409, 324], [404, 329],
            [418, 367], [432, 367], [444, 356], [445, 350], [449, 348], [449, 337], [459, 329], [456, 308]
        ])


class China(Country):
    def __init__(self):
        super().__init__("Китай", 1412000000, 0, 0.85, [
            [635, 201], [627, 199], [619, 193], [611, 185], [602, 197], [606, 202], [591, 209], [583, 214], [564, 213],
            [555, 209], [551, 201], [542, 189], [534, 209], [532, 215], [522, 220], [528, 230], [531, 238], [544, 246],
            [552, 242], [555, 246], [561, 241], [568, 246], [567, 253], [572, 258], [580, 253], [585, 258], [598, 250],
            [611, 241], [605, 229], [611, 224], [603, 222], [610, 218], [617, 219]
        ])


class Europe(Country):
    def __init__(self):
        super().__init__("Европа", 746400000, 0, 0.8, [
            [450, 194], [444, 189], [437, 179], [429, 185], [427, 175], [425, 162], [433, 153], [416, 142], [395, 163],
            [397, 173], [408, 173], [400, 183], [389, 193], [377, 174], [372, 176], [373, 184], [365, 187], [366, 192],
            [376, 191], [376, 194], [384, 194], [377, 201], [383, 206], [381, 212], [396, 211], [400, 221], [412, 227],
            [412, 221], [423, 221], [430, 231], [462, 225], [468, 219], [462, 225], [468, 219], [462, 217], [453, 208]
        ])


class North_America(Country):
    def __init__(self):
        super().__init__("Северная Америка", 579000000, 0, 0.75, [
            [231, 284], [227, 269], [219, 266], [221, 258], [212, 262], [202, 261], [201, 246], [215, 243], [227, 243],
            [231, 253],
            [226, 258], [246, 265], [268, 266], [247, 256], [232, 241], [242, 229], [250, 217], [284, 202], [278, 189],
            [264, 168],
            [260, 161], [270, 150], [257, 140], [240, 124], [235, 119], [238, 108], [266, 88], [234, 86], [204, 95],
            [189, 102], [177, 104],
            [154, 113], [153, 122], [145, 137], [133, 140], [90, 133], [73, 142], [80, 149], [70, 153], [82, 155],
            [76, 162], [72, 168],
            [90, 174], [69, 187], [97, 178], [105, 169], [124, 170], [151, 199], [159, 230], [190, 263]
        ])


class South_America(Country):
    def __init__(self):
        super().__init__("Южная Америка", 438000000, 0, 0.5, [
            [264, 417], [257, 411], [255, 403], [261, 397], [257, 393], [264, 386], [277, 375], [275, 369], [284, 367],
            [293, 357], [293, 348], [308, 342], [311, 327], [319, 312], [291, 301], [286, 289], [277, 288], [268, 280],
            [252, 276], [238, 283], [238, 295], [233, 300], [231, 309], [242, 327], [256, 340], [251, 366], [242, 395],
            [244, 411], [255, 417]
        ])


class Australia(Country):
    def __init__(self):
        super().__init__("Австралия", 26000000, 0, 0.45, [
            [649, 320], [645, 332], [638, 330], [637, 322], [628, 321], [623, 329], [618, 326], [608, 338], [597, 340],
            [595, 350], [599, 369], [613, 366], [622, 362], [632, 362], [639, 371], [648, 377], [660, 376], [668, 363],
            [669, 347]
        ])


class Greenland(Country):
    def __init__(self):
        super().__init__("Гренландия", 57000, 0, 0.55, [
            [360, 93], [345, 91], [334, 91], [312, 83], [297, 86], [272, 91], [259, 98], [262, 102], [248, 106],
            [256, 116],
            [271, 115], [281, 138], [287, 141], [283, 147], [293, 167], [301, 167], [308, 155], [317, 150], [323, 145],
            [336, 142],
            [343, 135], [336, 127], [343, 135], [336, 127], [349, 120], [349, 113], [344, 107]
        ])


class Russia(Country):
    def __init__(self):
        super().__init__("Россия", 146500000, 0, 0.9, [
            [740, 160], [740, 150], [710, 137], [679, 133], [659, 128], [627, 135], [620, 125], [595, 125], [595, 113],
            [578, 110],
            [514, 126], [500, 140], [463, 152], [428, 172], [428, 183], [438, 180], [459, 198], [455, 208], [469, 212],
            [474, 205],
            [472, 198], [482, 190], [484, 194], [497, 195], [500, 186], [513, 181], [520, 187], [527, 184], [540, 195],
            [568, 190],
            [590, 200], [603, 196], [612, 186], [621, 195], [634, 200], [630, 212], [646, 189], [640, 184], [648, 172],
            [670, 171],
            [678, 161], [688, 160], [687, 170], [717, 162], [721, 151]
        ])


class Xynta(Country):
    def __init__(self):
        super().__init__("Хунта", 1000000000, 0, 0.5, [
            [468, 223], [455, 243], [451, 243], [463, 266], [463, 273], [495, 256], [488, 251], [479, 251], [473, 241],
            [476, 238],
            [489, 248], [507, 250], [514, 258], [520, 258], [529, 283], [533, 281], [534, 269], [548, 257], [556, 256],
            [560, 269],
            [566, 266], [567, 284], [572, 290], [570, 293], [563, 288], [560, 290], [563, 288], [560, 290], [571, 305],
            [584, 314],
            [613, 316], [613, 319], [621, 314], [598, 314], [583, 311], [580, 306], [584, 303], [575, 302], [577, 290],
            [570, 285],
            [573, 257], [580, 281], [586, 276], [587, 270], [580, 262], [586, 257], [579, 252], [572, 257], [566, 252],
            [568, 245],
            [559, 241], [544, 245], [531, 238], [531, 238], [531, 232], [522, 222], [507, 217], [494, 207], [487, 208],
            [487, 214],
            [483, 214], [484, 223], [477, 225], [474, 221], [469, 221], [467, 222]
        ])
#       def update(self):
#          if self.population/2 < self.infected:
#              self.infected -= 5
